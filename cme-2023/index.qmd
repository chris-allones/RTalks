---
title: "R you ready?"
subtitle: "Intro to Structural equation modelling (SEM) in R"
format: 
  revealjs:
    theme: [simple, custom.scss]
    preview-links: true
    code-fold: true
    code-summary: "code"
    chalkboard: true
    slide-number: true
    footer: "R you ready? Intro to SEM in R | link: t.ly/G900 "
engine: knitr
from: markdown+emoji
include-after-body: "collapseoutput.js"
editor: visual
---

```{r}
#| echo: false
#| include: false
knitr::opts_chunk$set(comment = "", collapse = TRUE)
## working directory
setwd("~/GitHub-repo/RTalks/cme-2023")

## Libraries
library(tidyverse)
library(readxl)

```

## Outline

### Part I

-   R for reproducibility and replicability in research

-   R for academic teaching

### Part II

-   Intro to SEM

-   SEM demo

# R for reproducibility and replicability in research

## What is reproducibility and replicability in research?

<br>

::: columns
::: column
### Reproducibility {.center-text}

-   Obtaining computational results using the same input data, computational steps, methods, code and conditions of analysis.
:::

::: column
### Replicability {.center-text}

-   Obtaining consistent results across studies aimed at answering the same scientific question, each of which has obtained its own data.
:::
:::

<br>

::: {.source-text-smaller .center-text}
[Source: National Academies of Sciences, Engineering, and Medicine. 2019. Reproducibility and Replicability in Science. Washington, DC: The National Academy Press, https://doi.org/10.17226/25303](https://doi.org/10.17226/25303)
:::

## What is reproducibility and replicability in research?

<br>

::: columns
::: column
### Reproducibility {.center-text}

-   same procedures

-   same data

-   same code
:::

::: column
### Replicability {.center-text}

-   same procedures

-   new data

-   new code
:::
:::

## 

![](img/reproduce-replicate-issue.png){fig-align="center" width="50%" height="50%"}

::: {.source-text-smaller .center-text}
[Source: Baker, M. (2016). 1,500 scientists lift the lid on reproducibility. Nature, 533(7604), Article 7604. https://doi.org/10.1038/533452a](https://doi.org/10.1038/533452a)
:::

## 

![](img/rep-rep-bar.png){fig-align="center" width="105%" height="105%"}

::: {.source-text-smaller .center-text}
[Source: Baker, M. (2016). 1,500 scientists lift the lid on reproducibility. Nature, 533(7604), Article 7604. https://doi.org/10.1038/533452a](https://doi.org/10.1038/533452a)
:::

## R for reproducibility and replicability in research

<br>

+----------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Tips                                                           | Example                                                                                                                                                                                                                          |
+================================================================+==================================================================================================================================================================================================================================+
| Presenting supplementary information in a reproducible manner. | [Social capital and production risks: examining the association using the case of irrigated rice farms in Northern Thailand.](https://chris-allones.github.io/article-writing/icist_2022/20220808-icist-2022-data-analysis.html) |
+----------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Version control (e.g., GitHub)                                 | [GitHub repositories](https://github.com/chris-allones)                                                                                                                                                                          |
+----------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

# R for academic teaching

## 


```{r}
#| echo: false
#| eval: false

tibble(
  area = c("Academic", "Healthcare", "Government", "Consulting", "Insurance", "Energy",
           "Finance", "Retail", "Media", "Manufacturing", "Tech", "Electronics"),
  pct_traffic = c(7.5, 6.8, 3.4, 3.2, 2.4, 1.9, 1.8, 1.6, 1.4, 1.2, 1, 0.8)
) %>% 
  mutate(pct_traffic = pct_traffic / 100) %>% 
  mutate(area = fct_reorder(area, pct_traffic)) %>% 
  ggplot(aes(pct_traffic, area)) +
  geom_col(fill = "#1d3557", width = 0.7) +
  scale_x_continuous(expand = c(0, 0), limits = c(0, 0.08), breaks = seq(0, 0.08, 0.02),
                     labels = scales::percent_format()) +
  theme_minimal() +
  theme(plot.margin = margin(rep(20, 4)),
        plot.title = element_text(face = "bold"),
        axis.title.x = element_text(size = 12, margin = margin(t=15))
        ) +
  labs(title = "Visits to R by industry",
       subtitle = "Based on visits to Stack Overflow questions from US/UK.\nThe denominator in each is the total traffic from that industry.",
       x = "% of industry's traffic going to R",
       y = element_blank())

ggsave("img/r_industry_visit.jpeg", dpi = 300, width = 6.5, height = 7)
  
```


![](img/r_industry_visit.jpeg){fig-align="center" width="60%" height="60%"}


## 


```{r}
#| echo: false
#| eval: false

tibble(
  program = c("Python", "R", "SQL", "Big Data", "Apache Spark", "Hadoop",
              "Java", "Scala", "NLP", "ETL", "Deep Learning", "Tensor Flow",
              "MATLAB", "Pandas", "scikit-learn", "Keras", "Computer Vision",
              "PyTorch"),
  count = c(287, 245, 231, 221, 177, 164, 125, 104, 83, 81, 74, 38, 30, 29, 
            27, 17, 11, 6)
) %>% 
  mutate(program = fct_reorder(program, count)) %>% 
  ggplot(aes(count, program)) +
  geom_col(fill = "#1d3557", width = 0.7) +
  scale_x_continuous(expand = c(0, 0), breaks = seq(0, 300, 50), limits = c(0, 300)) +
  theme_minimal() +
  theme(plot.margin = margin(rep(20, 4)),
        plot.title = element_text(face = "bold"),
        axis.title.x = element_text(size = 12, margin = margin(t=15))
        ) +
  labs(title = "The skills data scienties need today",
       subtitle = "Based on 300 job listing from tech companies in June 2022",
       x = "% of industry's traffic going to R",
       y = element_blank())

ggsave("img/r_data_science.jpeg", dpi = 300, width = 6.5, height = 7)
```


![](img/r_data_science.jpeg){fig-align="center" width="60%" height="60%"}


## What R features supports teaching?

<br>

+-------------------------+-------------------------------------------------------------------------------------------------------------------------------+
| Tips                    | Example                                                                                                                       |
+=========================+===============================================================================================================================+
| Creating course website | [Personal teaching website](https://www.andrewheiss.com/)                                                                     |
+-------------------------+-------------------------------------------------------------------------------------------------------------------------------+
| Class presentation      | [CFA-CB SEM presentation](https://chris-allones.github.io/sem-2023-materials/sem_presentations/03-cfa-cb-sem/cfa-cb-sem.html) |
+-------------------------+-------------------------------------------------------------------------------------------------------------------------------+
| Training site           | [SEM training site](https://chris-allones.github.io/sem-2023/)                                                                |
+-------------------------+-------------------------------------------------------------------------------------------------------------------------------+
| Books                   | [R books](https://www.bigbookofr.com/)                                                                                        |
+-------------------------+-------------------------------------------------------------------------------------------------------------------------------+

## 

::: columns
::: column
![](img/any_question.gif)

# Any questions?
:::

::: column
:::
:::

# Introduction to Structural Equation Modelling (SEM)

## Why do an SEM?

::: columns
::: column
<br>

#### Principal reasons

-   Estimation of latent (unobserved) variables

-   Explicit assessment of measurement error

-   Testing statistical models that more closely align with theory
:::

::: column
![](img/measurement_part.jpg){fig-align="center"}
:::
:::

## 

```{r}
#| echo: false
#| eval: false
read_excel("data/sem_articles.xlsx", sheet = 1) %>% 
  mutate(subject_area = fct_reorder(subject_area, count)) %>% 
  ggplot(aes(count, subject_area)) + 
  geom_col(fill = "#1d3557") +
  geom_text(aes(label = count), hjust = -0.5, size = 3) +
  scale_x_continuous(expand = c(0, 0), limits = c(0, 3e4)) +
  theme_minimal() +
  theme(plot.margin = margin(rep(20, 4)),
        plot.title = element_text(face = "bold"),
        axis.title.x = element_text(margin = margin(t=20))) +
  labs(title = "SEM related journal articles",
       subtitle = str_wrap("A total of 83,863 articles covering the period 1978-2023 found in the Scopus database", 70),
       x = "Number of articles indexed in the Scopus database",
       y = element_blank())

ggsave("img/sem_subject_area.jpeg", dpi = 300, width = 8, height = 7)
```

::: columns
::: {.column width="80%"}
![](img/sem_subject_area.jpeg){fig-align="left"}
:::

::: {.column width="20%"}
<br>

<br>

```{r}
#| echo: true
#| eval: false
#| class-output: "remark-code"

## Plotting count of SEM articles 
read_excel("data/sem_articles.xlsx", sheet = 1) %>% 
  mutate(subject_area = fct_reorder(subject_area, count)) %>% 
  ggplot(aes(count, subject_area)) + 
  geom_col() +
  geom_text(aes(label = count), hjust = -0.5, size = 3) +
  scale_x_continuous(expand = c(0, 0), limits = c(0, 3e4)) +
  theme_minimal() +
  theme(plot.margin = margin(rep(20, 4))) +
  labs(title = "SEM related journal articles",
       subtitle = str_wrap("A total of 83,863 articles covering the period 1978-2023 found in the Scopus database", 70),
       x = "Number of articles indexed in the Scopus database",
       y = element_blank())
```
:::
:::

## 

```{r}
#| echo: false
#| eval: false

read_excel("data/sem_articles.xlsx", sheet = 2) %>% 
  filter(year < 2023) %>% 
  ggplot(aes(year, count)) + 
  geom_line(linewidth= 1) +
  geom_text(data = . %>% filter(year > 2010),
            aes(label = count), hjust = -0.5, size = 3) +
  scale_x_continuous(expand = c(0, 0), limits = c(1975, 2030), 
                     breaks = c(seq(1975, 2020, 10), 2022)) +
  scale_y_continuous(limits = c(0, 15e3), breaks = seq(0, 15e3, 2500)) +
  theme_minimal() +
  theme(plot.margin = margin(rep(20, 4)),
        plot.title = element_text(face = "bold"),
        axis.title.y = element_text(margin = margin(r=20))) +
  labs(title = "Growth of SEM related journal articles",
       subtitle = str_wrap("A total of 83,863 articles covering the period 1978-2023 found in the Scopus database", 75),
       y = "Number of articles indexed in the Scopus database",
       x = element_blank())

ggsave("img/sem_time.jpeg", dpi = 300, width = 7, height = 5)
```

::: columns
::: {.column width="80%"}
![](img/sem_time.jpeg){fig-align="left"}
:::

::: {.column width="20%"}
<br>

<br>

```{r}
#| echo: true
#| eval: false
#| class-output: "remark-code"

## Plotting count of SEM articles across time
read_excel("data/sem_articles.xlsx", sheet = 2) %>% 
  filter(year < 2023) %>% 
  ggplot(aes(year, count)) + 
  geom_line(linewidth= 1) +
  geom_text(data = . %>% filter(year > 2010),
            aes(label = count), hjust = -0.5, size = 3) +
  scale_x_continuous(expand = c(0, 0), limits = c(1975, 2030), 
                     breaks = c(seq(1975, 2020, 10), 2022)) +
  scale_y_continuous(limits = c(0, 15e3), breaks = seq(0, 15e3, 2500)) +
  theme_minimal() +
  theme(plot.margin = margin(rep(20, 4)),
        plot.title = element_text(face = "bold"),
        axis.title.y = element_text(margin = margin(r=20))) +
  labs(title = "Growth of SEM related journal articles",
       subtitle = str_wrap("A total of 83,863 articles covering the period 1978-2023 found in the Scopus database", 75),
       y = "Number of articles indexed in the Scopus database",
       x = element_blank())
```
:::
:::

## Available statistical software for SEM

<br>

+--------------------------+--------------------------------------------------------------------------------------+-----------------------------+
| SEM type                 | Statistical software                                                                 | Subscription fee            |
+==========================+======================================================================================+=============================+
| Covariance based SEM     | 1.  [AMOS](https://www.ibm.com/products/structural-equation-modeling-sem)            | 1.  \~3500 pesos annually   |
|                          | 2.  [Lavaan package in R](https://lavaan.ugent.be/)                                  | 2.  free                    |
+--------------------------+--------------------------------------------------------------------------------------+-----------------------------+
| Partial least-square SEM | 1.  [SmartPLS](https://www.smartpls.com/)                                            | 1.  \~ 14000 pesos annually |
|                          | 2.  [seminR package in R](https://cran.r-project.org/web/packages/seminr/index.html) | 2.  free                    |
+--------------------------+--------------------------------------------------------------------------------------+-----------------------------+
|                          |                                                                                      |                             |
+--------------------------+--------------------------------------------------------------------------------------+-----------------------------+

## Steps in doing SEM {.center-text}

![](img/overview_factor.jpg){fig-align="center"}

## Approaches in SEM {.center-text}

<br>

::: columns
::: column
#### Covariance based SEM

-   based on covariance
-   theory testing and confirmation
:::

::: column
### Partial least-square SEM

-   variance based (partial least-square)
-   prediction and theory development
:::
:::

<br>

::: center-text
*"Choice of the method originates from the goal of research. If the existing theory needs to be tested and confirmed, CB-SEM is the chosen one. Nevertheless, for theory development as well as prediction purposes, PLS-SEM is better."* - [Dash and Paul (2021)](https://doi.org/10.1016/j.techfore.2021.121092)

<br>

*"... both methods are complementary, not competitive"* - [Hair (2017)](https://www.inderscienceonline.com/doi/epdf/10.1504/IJMDA.2017.087624)
:::

## CB-SEM or PLS-SEM {.center-text}

![](img/cb_pls.png){fig-align="center" width="50%" height="50%"}

::: source-text
H., Hair Jr, F., J., Matthews, L.M., Matthews, R.L., Sarstedt, M., 2017. PLS-SEM or CBSEM: updated guidelines on which method to use. Int. J. Multivar. Data Anal. 1 (2), 107--123. https://doi.org/10.1504/IJMDA.2017.087624.
:::

## 

::: columns
::: {.column .center-text width="40%"}
<br>

### It's better to show the power of SEM in ACTION!

### LET'S GO!
:::

::: {.column width="60%"}
![](img/typing_cat.gif)
:::
:::



## {.center-text}

Click the [CB-SEM]() and [PLS-SEM]() to access the demo.

![](img/bravocado.gif){width=70% height=70%}











